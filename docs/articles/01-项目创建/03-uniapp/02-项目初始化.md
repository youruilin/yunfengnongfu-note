# Pinia åˆå§‹åŒ–

ç”¨æ³•ä¸ Vue3 å®Œå…¨ä¸€è‡´ï¼Œä»…éœ€é€‚é…å…¼å®¹æ€§é—®é¢˜ã€‚

### æŒä¹…åŒ–å­˜å‚¨æ’ä»¶

å®‰è£…æŒä¹…åŒ–å­˜å‚¨æ’ä»¶ï¼š [pinia-plugin-persistedstate](https://prazdevs.github.io/pinia-plugin-persistedstate/zh/guide/config.html#storage)

```bash
pnpm i pinia pinia-plugin-persistedstate
```

æ’ä»¶é»˜è®¤ä½¿ç”¨ `localStorage` å®ç°æŒä¹…åŒ–ï¼Œå°ç¨‹åºç«¯ä¸å…¼å®¹ï¼Œéœ€è¦æ›¿æ¢æŒä¹…åŒ– APIã€‚

ä»¥åŠå®‰è£…å¿…è¦çš„ä¾èµ–ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ„å»ºmp-weixinæŠ¥é”™ï¼š

```
pnpm add destr deep-pick-omit -D
```



### å®˜æ–¹æ–‡æ¡£

åœ¨æ·±å…¥ç ”ç©¶æ ¸å¿ƒæ¦‚å¿µä¹‹å‰ï¼Œæˆ‘ä»¬å¾—çŸ¥é“ Store æ˜¯ç”¨ `defineStore()` å®šä¹‰çš„ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°è¦æ±‚æ˜¯ä¸€ä¸ª**ç‹¬ä¸€æ— äºŒçš„**åå­—ï¼š

```ts
import { defineStore } from 'pinia'

//  `defineStore()` çš„è¿”å›å€¼çš„å‘½åæ˜¯è‡ªç”±çš„
// ä½†æœ€å¥½å«æœ‰ store çš„åå­—ï¼Œä¸”ä»¥ `use` å¼€å¤´ï¼Œä»¥ `Store` ç»“å°¾ã€‚
// (æ¯”å¦‚ `useUserStore`ï¼Œ`useCartStore`ï¼Œ`useProductStore`)
// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½ çš„åº”ç”¨ä¸­ Store çš„å”¯ä¸€ IDã€‚
export const useAlertsStore = defineStore('alerts', {
  // å…¶ä»–é…ç½®...
})
```

è¿™ä¸ª**åå­—** ï¼Œä¹Ÿè¢«ç”¨ä½œ *id* ï¼Œæ˜¯å¿…é¡»ä¼ å…¥çš„ï¼Œ Pinia å°†ç”¨å®ƒæ¥è¿æ¥ store å’Œ devtoolsã€‚ä¸ºäº†å…»æˆä¹ æƒ¯æ€§çš„ç”¨æ³•ï¼Œå°†è¿”å›çš„å‡½æ•°å‘½åä¸º *use...* æ˜¯ä¸€ä¸ªç¬¦åˆç»„åˆå¼å‡½æ•°é£æ ¼çš„çº¦å®šã€‚

`defineStore()` çš„ç¬¬äºŒä¸ªå‚æ•°å¯æ¥å—ä¸¤ç±»å€¼ï¼šSetup å‡½æ•°æˆ– Option å¯¹è±¡ã€‚

## Option Store

ä¸ Vue çš„é€‰é¡¹å¼ API ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰ `state`ã€`actions` ä¸ `getters` å±æ€§çš„ Option å¯¹è±¡ï¼š

```ts
export const useCounterStore = defineStore('counter', {
  state: () => ({ count: 0, name: 'Eduardo' }),
  getters: {
    doubleCount: (state) => state.count * 2,
  },
  actions: {
    increment() {
      this.count++
    },
  },
})
```

ä½ å¯ä»¥è®¤ä¸º `state` æ˜¯ store çš„æ•°æ® (`data`)ï¼Œ`getters` æ˜¯ store çš„è®¡ç®—å±æ€§ (`computed`)ï¼Œè€Œ `actions` åˆ™æ˜¯æ–¹æ³• (`methods`)ã€‚

ä¸ºæ–¹ä¾¿ä¸Šæ‰‹ä½¿ç”¨ï¼ŒOption Store åº”å°½å¯èƒ½ç›´è§‚ç®€å•ã€‚

## Setup Store

ä¹Ÿå­˜åœ¨å¦ä¸€ç§å®šä¹‰ store çš„å¯ç”¨è¯­æ³•ã€‚ä¸ Vue ç»„åˆå¼ API çš„ [setup å‡½æ•°](https://cn.vuejs.org/api/composition-api-setup.html) ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å®šä¹‰äº†ä¸€äº›å“åº”å¼å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¸¦æœ‰æˆ‘ä»¬æƒ³æš´éœ²å‡ºå»çš„å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ã€‚

```ts
export const useCounterStore = defineStore('counter', () => {
  const count = ref(0)
  const name = ref('Eduardo')
  const doubleCount = computed(() => count.value * 2)
  function increment() {
    count.value++
  }

  return { count, name, doubleCount, increment }
})
```

åœ¨ *Setup Store* ä¸­ï¼š

- `ref()` å°±æ˜¯ `state` å±æ€§
- `computed()` å°±æ˜¯ `getters`
- `function()` å°±æ˜¯ `actions`

æ³¨æ„ï¼Œè¦è®© pinia æ­£ç¡®è¯†åˆ« `state`ï¼Œä½ **å¿…é¡»**åœ¨ setup store ä¸­è¿”å› **`state` çš„æ‰€æœ‰å±æ€§**ã€‚è¿™æ„å‘³ç€ï¼Œä½ ä¸èƒ½åœ¨ store ä¸­ä½¿ç”¨**ç§æœ‰**å±æ€§ã€‚ä¸å®Œæ•´è¿”å›ä¼šå½±å“ [SSR](https://pinia.vuejs.org/zh/cookbook/composables.html) ï¼Œå¼€å‘å·¥å…·å’Œå…¶ä»–æ’ä»¶çš„æ­£å¸¸è¿è¡Œã€‚

Setup store æ¯” [Option Store](https://pinia.vuejs.org/zh/core-concepts/#option-stores) å¸¦æ¥äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨ä¸€ä¸ª store å†…åˆ›å»ºä¾¦å¬å™¨ï¼Œå¹¶è‡ªç”±åœ°ä½¿ç”¨ä»»ä½•[ç»„åˆå¼å‡½æ•°](https://cn.vuejs.org/guide/reusability/composables.html#composables)ã€‚ä¸è¿‡ï¼Œè¯·è®°ä½ï¼Œä½¿ç”¨ç»„åˆå¼å‡½æ•°ä¼šè®© SSR å˜å¾—æ›´åŠ å¤æ‚ã€‚

Setup store ä¹Ÿå¯ä»¥ä¾èµ–äºå…¨å±€**æä¾›**çš„å±æ€§ï¼Œæ¯”å¦‚è·¯ç”±ã€‚ä»»ä½•[åº”ç”¨å±‚é¢æä¾›](https://vuejs.org/api/application.html#app-provide)çš„å±æ€§éƒ½å¯ä»¥åœ¨ store ä¸­ä½¿ç”¨ `inject()` è®¿é—®ï¼Œå°±åƒåœ¨ç»„ä»¶ä¸­ä¸€æ ·ï¼š

```ts
import { inject } from 'vue'
import { useRoute } from 'vue-router'
import { defineStore } from 'pinia'

export const useSearchFilters = defineStore('search-filters', () => {
  const route = useRoute()
  // è¿™é‡Œå‡å®š `app.provide('appProvided', 'value')` å·²ç»è°ƒç”¨è¿‡
  const appProvided = inject('appProvided')

  // ...

  return {
    // ...
  }
})
```

::: denger WARNING

ä¸è¦è¿”å›åƒ `route` æˆ– `appProvided` (ä¸Šä¾‹ä¸­)ä¹‹ç±»çš„å±æ€§ï¼Œå› ä¸ºå®ƒä»¬ä¸å±äº storeï¼Œè€Œä¸”ä½ å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥ç”¨ `useRoute()` å’Œ `inject('appProvided')` è®¿é—®ã€‚

::: 

## ä½ åº”è¯¥é€‰ç”¨å“ªç§è¯­æ³•ï¼Ÿ

å’Œ[åœ¨ Vue ä¸­å¦‚ä½•é€‰æ‹©ç»„åˆå¼ API ä¸é€‰é¡¹å¼ API](https://cn.vuejs.org/guide/introduction.html#which-to-choose) ä¸€æ ·ï¼Œé€‰æ‹©ä½ è§‰å¾—æœ€èˆ’æœçš„é‚£ä¸€ä¸ªå°±å¥½ã€‚ä¸¤ç§è¯­æ³•éƒ½æœ‰å„è‡ªçš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚Option Store æ›´å®¹æ˜“ä½¿ç”¨ï¼Œè€Œ Setup Store æ›´çµæ´»å’Œå¼ºå¤§ã€‚å¦‚æœä½ æƒ³æ·±å…¥äº†è§£ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼Œè¯·æŸ¥çœ‹ Mastering Pinia ä¸­çš„ [Option Stores vs Setup Stores ç« èŠ‚](https://masteringpinia.com/lessons/when-to-choose-one-syntax-over-the-other)ã€‚

## ä½¿ç”¨ Store

è™½ç„¶æˆ‘ä»¬å‰é¢å®šä¹‰äº†ä¸€ä¸ª storeï¼Œä½†åœ¨æˆ‘ä»¬ä½¿ç”¨ `<script setup>` è°ƒç”¨ `useStore()`(æˆ–è€…ä½¿ç”¨ `setup()` å‡½æ•°ï¼Œ**åƒæ‰€æœ‰çš„ç»„ä»¶é‚£æ ·**) ä¹‹å‰ï¼Œstore å®ä¾‹æ˜¯ä¸ä¼šè¢«åˆ›å»ºçš„ï¼š

```vue
<script setup>
import { useCounterStore } from '@/stores/counter'
// åœ¨ç»„ä»¶å†…éƒ¨çš„ä»»ä½•åœ°æ–¹å‡å¯ä»¥è®¿é—®å˜é‡ `store` âœ¨
const store = useCounterStore()
</script>
```

TIP

å¦‚æœä½ è¿˜ä¸ä¼šä½¿ç”¨ `setup` ç»„ä»¶ï¼Œ[ä½ ä¹Ÿå¯ä»¥é€šè¿‡**æ˜ å°„è¾…åŠ©å‡½æ•°**æ¥ä½¿ç”¨ Pinia](https://pinia.vuejs.org/zh/cookbook/options-api.html)ã€‚

ä½ å¯ä»¥å®šä¹‰ä»»æ„å¤šçš„ storeï¼Œä½†ä¸ºäº†è®©ä½¿ç”¨ pinia çš„ç›Šå¤„æœ€å¤§åŒ–(æ¯”å¦‚å…è®¸æ„å»ºå·¥å…·è‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²ä»¥åŠ TypeScript æ¨æ–­)ï¼Œ**ä½ åº”è¯¥åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­å»å®šä¹‰ store**ã€‚

ä¸€æ—¦ store è¢«å®ä¾‹åŒ–ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®åœ¨ store çš„ `state`ã€`getters` å’Œ `actions` ä¸­å®šä¹‰çš„ä»»ä½•å±æ€§ã€‚æˆ‘ä»¬å°†åœ¨åç»­ç« èŠ‚ç»§ç»­äº†è§£è¿™äº›ç»†èŠ‚ï¼Œç›®å‰è‡ªåŠ¨è¡¥å…¨å°†å¸®åŠ©ä½ ä½¿ç”¨ç›¸å…³å±æ€§ã€‚

è¯·æ³¨æ„ï¼Œ`store` æ˜¯ä¸€ä¸ªç”¨ `reactive` åŒ…è£…çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦åœ¨ getters åé¢å†™ `.value`ã€‚å°±åƒ `setup` ä¸­çš„ `props` ä¸€æ ·ï¼Œ**æˆ‘ä»¬ä¸èƒ½å¯¹å®ƒè¿›è¡Œè§£æ„**ï¼š

```ts
<script setup>
import { useCounterStore } from '@/stores/counter'
import { computed } from 'vue'

const store = useCounterStore()
// âŒ ä¸‹é¢è¿™éƒ¨åˆ†ä»£ç ä¸ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºå®ƒçš„å“åº”å¼è¢«ç ´åäº†
// ä¸ reactive ç›¸åŒ: https://vuejs.org/guide/essentials/reactivity-fundamentals.html#limitations-of-reactive
const { name, doubleCount } = store
name // å°†ä¼šä¸€ç›´æ˜¯ "Eduardo" //
doubleCount // å°†ä¼šä¸€ç›´æ˜¯ 0 //
setTimeout(() => {
  store.increment()
}, 1000)
// âœ… è€Œè¿™ä¸€éƒ¨åˆ†ä»£ç å°±ä¼šç»´æŒå“åº”å¼
// ğŸ’¡ åœ¨è¿™é‡Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `store.doubleCount`
const doubleValue = computed(() => store.doubleCount)
</script>
```

## ä» Store è§£æ„

ä¸ºäº†ä» store ä¸­æå–å±æ€§æ—¶ä¿æŒå…¶å“åº”æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨ `storeToRefs()`ã€‚å®ƒå°†ä¸ºæ¯ä¸€ä¸ªå“åº”å¼å±æ€§åˆ›å»ºå¼•ç”¨ã€‚å½“ä½ åªä½¿ç”¨ store çš„çŠ¶æ€è€Œä¸è°ƒç”¨ä»»ä½• action æ—¶ï¼Œå®ƒä¼šéå¸¸æœ‰ç”¨ã€‚è¯·æ³¨æ„ï¼Œä½ å¯ä»¥ç›´æ¥ä» store ä¸­è§£æ„ actionï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿè¢«ç»‘å®šåˆ° store ä¸Šï¼š

```ts
<script setup>
import { storeToRefs } from 'pinia'
import { useCounterStore } from '@/stores/counter' // éœ€è¦å¼•å…¥ store
const store = useCounterStore()
// `name` å’Œ `doubleCount` éƒ½æ˜¯å“åº”å¼å¼•ç”¨
// ä¸‹é¢çš„ä»£ç åŒæ ·ä¼šæå–é‚£äº›æ¥è‡ªæ’ä»¶çš„å±æ€§çš„å“åº”å¼å¼•ç”¨
// ä½†æ˜¯ä¼šè·³è¿‡æ‰€æœ‰çš„ action æˆ–è€…éå“åº”å¼ï¼ˆé ref æˆ–è€… é reactiveï¼‰çš„å±æ€§
const { name, doubleCount } = storeToRefs(store)
// åä¸º increment çš„ action å¯ä»¥è¢«è§£æ„
const { increment } = store
</script>
```



# Pinia é…ç½®

## åŸºæœ¬é…ç½®

::: code-group

```ts [store/modules/members.ts]
import { defineStore } from 'pinia'
import { ref } from 'vue'

// å®šä¹‰ Store
export const useMemberStore = defineStore(
  'member',
  () => {
    // ä¼šå‘˜ä¿¡æ¯
    const profile = ref<any>()

    // ä¿å­˜ä¼šå‘˜ä¿¡æ¯ï¼Œç™»å½•æ—¶ä½¿ç”¨
    const setProfile = (val: any) => {
      profile.value = val
    }

    // æ¸…ç†ä¼šå‘˜ä¿¡æ¯ï¼Œé€€å‡ºæ—¶ä½¿ç”¨
    const clearProfile = () => {
      profile.value = undefined
    }

    // è®°å¾— return
    return {
      profile,
      setProfile,
      clearProfile,
    }
  },
  // TODO: æŒä¹…åŒ–
  {
    persist: true,
  },
)
```

``` ts [store/index.ts]
import { createPinia } from 'pinia'
import persist from 'pinia-plugin-persistedstate'

// åˆ›å»º pinia å®ä¾‹
const pinia = createPinia()
// ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨æ’ä»¶
pinia.use(persist)

// é»˜è®¤å¯¼å‡ºï¼Œç»™ main.ts ä½¿ç”¨
export default pinia

// æ¨¡å—ç»Ÿä¸€å¯¼å‡º
export * from './modules/member'
```

``` ts [main.ts]
import { createSSRApp } from 'vue'
import pinia from './stores'

import App from './App.vue'
export function createApp() {
  const app = createSSRApp(App)

  app.use(pinia)
  return {
    app,
  }
}
```

:::

## å¤šç«¯å…¼å®¹

**ç½‘é¡µç«¯æŒä¹…åŒ– API**

```
// ç½‘é¡µç«¯API
localStorage.setItem()
localStorage.getItem()
```

**å¤šç«¯æŒä¹…åŒ– API**

```
// å…¼å®¹å¤šç«¯API
uni.setStorageSync()
uni.getStorageSync()
```

**å‚è€ƒä»£ç **

```ts
// stores/modules/member.ts
export const useMemberStore = defineStore(
  'member',
  () => {
    //â€¦çœç•¥
  },
  {
    // é…ç½®æŒä¹…åŒ–
    persist: {
      // è°ƒæ•´ä¸ºå…¼å®¹å¤šç«¯çš„API
      storage: {
        setItem(key, value) {
          uni.setStorageSync(key, value) 
        },
        getItem(key) {
          return uni.getStorageSync(key) 
        },
      },
    },
  },
)
```

# æ‹¦æˆªå™¨&è¯·æ±‚å‡½æ•°

## æ‹¦æˆªå™¨ - åˆ›å»º http.ts æ¨¡å—

**uniapp æ‹¦æˆªå™¨**ï¼š [uni.addInterceptor](https://uniapp.dcloud.net.cn/api/interceptor.html)

**æ¥å£è¯´æ˜**ï¼š[æ¥å£æ–‡æ¡£](https://www.apifox.cn/apidoc/shared-0e6ee326-d646-41bd-9214-29dbf47648fa/doc-1521513)

å®ç°éœ€æ±‚

1. æ‹¼æ¥åŸºç¡€åœ°å€
2. è®¾ç½®è¶…æ—¶æ—¶é—´
3. æ·»åŠ è¯·æ±‚å¤´æ ‡è¯†
4. æ·»åŠ  token

src/utils/http.ts

```ts
// src/utils/http.ts

import { useMemberStore } from '@/stores'

// è¯·æ±‚åŸºåœ°å€
const baseURL = 'https://pcapi-xiaotuxian-front-devtest.itheima.net'

// æ‹¦æˆªå™¨é…ç½®
const httpInterceptor = {
  // æ‹¦æˆªå‰è§¦å‘
  invoke(options: UniApp.RequestOptions) {
    // 1. é http å¼€å¤´éœ€æ‹¼æ¥åœ°å€
    if (!options.url.startsWith('http')) {
      options.url = baseURL + options.url
    }
    // 2. è¯·æ±‚è¶…æ—¶
    options.timeout = 10000
    // 3. æ·»åŠ å°ç¨‹åºç«¯è¯·æ±‚å¤´æ ‡è¯†
    options.header = {
      'source-client': 'miniapp',
      ...options.header,
    }
    // 4. æ·»åŠ  token è¯·æ±‚å¤´æ ‡è¯†
    const memberStore = useMemberStore()
    const token = memberStore.profile?.token
    if (token) {
      options.header.Authorization = token
    }
  },
}

// æ‹¦æˆª request è¯·æ±‚
uni.addInterceptor('request', httpInterceptor)
// æ‹¦æˆª uploadFile æ–‡ä»¶ä¸Šä¼ 
uni.addInterceptor('uploadFile', httpInterceptor)
```



## å°è£… Promise è¯·æ±‚å‡½æ•°

å®ç°éœ€æ±‚

1. è¿”å› Promise å¯¹è±¡ï¼Œç”¨äºå¤„ç†è¿”å›å€¼ç±»å‹
2. æˆåŠŸ resolve
   1. æå–æ•°æ®
   2. æ·»åŠ æ³›å‹
3. å¤±è´¥ reject
   1. 401 é”™è¯¯
   2. å…¶ä»–é”™è¯¯
   3. ç½‘ç»œé”™è¯¯

**å‚è€ƒä»£ç **

```ts
/**
 * è¯·æ±‚å‡½æ•°
 * @param  UniApp.RequestOptions
 * @returns Promise
 *  1. è¿”å› Promise å¯¹è±¡ï¼Œç”¨äºå¤„ç†è¿”å›å€¼ç±»å‹
 *  2. è·å–æ•°æ®æˆåŠŸ
 *    2.1 æå–æ ¸å¿ƒæ•°æ® res.data
 *    2.2 æ·»åŠ ç±»å‹ï¼Œæ”¯æŒæ³›å‹
 *  3. è·å–æ•°æ®å¤±è´¥
 *    3.1 401é”™è¯¯  -> æ¸…ç†ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
 *    3.2 å…¶ä»–é”™è¯¯ -> æ ¹æ®åç«¯é”™è¯¯ä¿¡æ¯è½»æç¤º
 *    3.3 ç½‘ç»œé”™è¯¯ -> æç¤ºç”¨æˆ·æ¢ç½‘ç»œ
 */
type Data<T> = {
  code: string
  msg: string
  result: T
}
// 2.2 æ·»åŠ ç±»å‹ï¼Œæ”¯æŒæ³›å‹
export const http = <T>(options: UniApp.RequestOptions) => {
  // 1. è¿”å› Promise å¯¹è±¡
  return new Promise<Data<T>>((resolve, reject) => {
    uni.request({
      ...options,
      // å“åº”æˆåŠŸ
      success(res) {
        // çŠ¶æ€ç  2xxï¼Œå‚è€ƒ axios çš„è®¾è®¡
        if (res.statusCode >= 200 && res.statusCode < 300) {
          // 2.1 æå–æ ¸å¿ƒæ•°æ® res.data
          resolve(res.data as Data<T>)
        } else if (res.statusCode === 401) {
          // 401é”™è¯¯  -> æ¸…ç†ç”¨æˆ·ä¿¡æ¯ï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
          const memberStore = useMemberStore()
          memberStore.clearProfile()
          uni.navigateTo({ url: '/pages/login/login' })
          reject(res)
        } else {
          // å…¶ä»–é”™è¯¯ -> æ ¹æ®åç«¯é”™è¯¯ä¿¡æ¯è½»æç¤º
          uni.showToast({
            icon: 'none',
            title: (res.data as Data<T>).msg || 'è¯·æ±‚é”™è¯¯',
          })
          reject(res)
        }
      },
      // å“åº”å¤±è´¥
      fail(err) {
        uni.showToast({
          icon: 'none',
          title: 'ç½‘ç»œé”™è¯¯ï¼Œæ¢ä¸ªç½‘ç»œè¯•è¯•',
        })
        reject(err)
      },
    })
  })
}
```



## è®¾ç½®ç±»å‹

![image-20251004161705373](../../../public/image-è®¾ç½®ç±»å‹.png)

# è‡ªå®šä¹‰å¯¼èˆªæ 

## å‰ç½®

```json
// src/pages.json
{
  "path": "pages/index/index",
  "style": {
    "navigationStyle": "custom", // éšè—é»˜è®¤å¯¼èˆª
    "navigationBarTextStyle": "white",
    "navigationBarTitleText": "é¦–é¡µ"
  }
}
```

## å®‰å…¨åŒºåŸŸçš„æ¦‚å¿µ

ä¸åŒæ‰‹æœºçš„å®‰å…¨åŒºåŸŸä¸åŒï¼Œé€‚é…å®‰å…¨åŒºåŸŸèƒ½é˜²æ­¢é¡µé¢é‡è¦å†…å®¹è¢«é®æŒ¡ã€‚

å¯é€šè¿‡ `uni.getSystemInfoSync()` è·å–å±å¹•è¾¹ç•Œåˆ°å®‰å…¨åŒºçš„è·ç¦»ã€‚

![img](../../../public/image-ç§»åŠ¨ç«¯å®‰å…¨åŒºåŸŸ.png)

```ts
// è·å–å±å¹•è¾¹ç•Œåˆ°å®‰å…¨åŒºåŸŸè·ç¦»
const { safeAreaInsets } = uni.getSystemInfoSync
```

å¯èƒ½éœ€è¦åœ¨ eslint é…ç½®ä¸­å£°æ˜ï¼š

```json
{
  files: ['**/*.{js,mjs,cjs,ts,mts,cts,vue}'],
  plugins: { js },
  extends: ['js/recommended'],
  // å¢åŠ  uni: 'readonly'
  languageOptions: { globals: { ...globals.browser, ...globals.node, uni: 'readonly' } },
},
```

å®Œæ•´çš„ç»„ä»¶ä»£ç ï¼š

```
```



# iconfont å›¾æ ‡

é¦–å…ˆï¼Œä¸‹è½½æ‰€éœ€è¦çš„ iconfont æ–‡ä»¶ï¼š

ç„¶åï¼Œåˆ°é¡¹ç›®æ ¹ç»„ä»¶ App.vue ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```vue {13-37}
<script setup lang="ts">
import { onLaunch, onShow, onHide } from '@dcloudio/uni-app'
onLaunch(() => {
  console.log('App Launch')
})
onShow(() => {
  console.log('App Show') 
})
onHide(() => {
  console.log('App Hide') 
})
</script>
<style>
/* å­—ä½“å®šä¹‰å¿…é¡»åœ¨æ‰€æœ‰æ ·å¼ä¹‹å‰ */ 
@font-face { 
  font-family: 'iconfont';
  src:
    url('/static/fonts/iconfont.woff2') format('woff2'),
    url('/static/fonts/iconfont.woff') format('woff'),
    url('/static/fonts/iconfont.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: block;
  /* æ·»åŠ è¿™ä¸€è¡Œ */
}

/* åŸºç¡€å›¾æ ‡æ ·å¼ */
.iconfont {
  font-family: 'iconfont' !important;
  font-size: 16px;
  font-style: normal;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  display: inline-block;
  /* æ·»åŠ è¿™ä¸€è¡Œ */
}
</style>

```

ä½¿ç”¨ï¼š

```vue
<template>
  <view
    class="navbar"
    :style="{ paddingTop: safeAreaInsets?.top + 'px' }"
  >
    <!-- logoæ–‡å­— -->
    <view class="logo">
      <image
        class="logo-image"
        src="@/static/images/yun-logo.png"
      ></image>
      <text class="logo-image-text">äº‘å³°å†œæœ</text>
      <!-- <text class="logo-text">å¿«æ· Â· æ˜“ç”¨ Â· é«˜æ•ˆ</text> -->
    </view>

    <!-- æœç´¢æ¡ -->
    <!-- <view class="search">
      <text class="icon-search">æœç´¢å•†å“</text>
      <text class="icon-scan"></text>
    </view> -->

    <!-- navBar-bottom -->
    <view class="navbar-bottom">
      <div class="tianqi">
        <text class="tianqi-temp">28Â°</text>
        <text class="tianqi-desc">æ™´</text>
        <image
          class="tianqi-icon"
          src="@/static/icon/å¤©æ°”-æ™´.svg"
        ></image>
      </div>
      <div class="location">
        <text class="iconfont location-icon">&#xe790;</text>
        <text class="info-text">ç‰¡ä¸¹åŒº</text>
      </div>
      <div class="shidu">
        <text class="iconfont shidu-icon">&#xe682;</text>
        <text class="info-text">65%</text>
      </div>
      <div class="air">
        <text class="iconfont air-icon">&#xe60e;</text>
        <text class="info-text air-text">è‰¯å¥½</text>
      </div>
    </view>
  </view>
</template>
```



# å…³äºvueæ–‡ä»¶è¡Œå†…æ ·å¼æ¢è¡Œçš„å°å‘

éœ€è¦åœ¨ settings.json å½“ä¸­æ˜ç¡®æŒ‡å®š vue æ–‡ä»¶çš„æ ¼å¼åŒ–å·¥å…·ï¼š

```json
{
  // ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–
  "editor.formatOnSave": true,
  // å¯ç”¨ ESLint Flat Config
  "eslint.useFlatConfig": true,
  // "editor.defaultFormatter": "dbaeumer.vscode-eslint",
  // æ–‡ä»¶æ ¼å¼åŒ–é…ç½®
  "[json]": {
    // "editor.defaultFormatter": "vscode.json-language-features"
    // ä½†å®é™…ä¸Šï¼Œå› ä¸º eslint.validate ä¸åŒ…å« jsonï¼ŒESLint ä¸ä¼šå¤„ç†æ™®é€š JSON æ–‡ä»¶
    // æ‰€ä»¥ä¿å­˜æ—¶ä¼šå›é€€åˆ° VSCode å†…ç½®çš„ JSON æ ¼å¼åŒ–å™¨
    // "editor.defaultFormatter": "dbaeumer.vscode-eslint"
  },
  "[jsonc]": {
    // åªè°ƒç”¨ VSCode å†…ç½®çš„ JSON/JSONC æ ¼å¼åŒ–å™¨ã€‚
    // "editor.defaultFormatter": "vscode.json-language-features",
    //
    "editor.defaultFormatter": "dbaeumer.vscode-eslint",
    "editor.tabSize": 4,
    "editor.insertSpaces": true
  },
  // ESLint æ ¡éªŒèŒƒå›´
  "eslint.validate": ["javascript", "vue", "jsonc"],
  // é…ç½®è¯­è¨€çš„æ–‡ä»¶å…³è”
  "files.associations": {
    "pages.json": "jsonc",
    "manifest.json": "jsonc"
  },
  "typescript.tsdk": "node_modules\\typescript\\lib",

  // --- æ–°å¢é…ç½®ï¼šåªé’ˆå¯¹ Vue/JS ä½¿ç”¨ Prettier ---  // [!code ++]
  "[vue]": { // [!code ++]
    "editor.defaultFormatter": "dbaeumer.vscode-eslint" // [!code ++]
  }, // [!code ++]
  "[javascript]": { // [!code ++]
    "editor.defaultFormatter": "dbaeumer.vscode-eslint" // [!code ++]
  }, // [!code ++]
  "editor.codeActionsOnSave": { // [!code ++]
    "source.fixAll.eslint": "explicit", // [!code ++]
    "source.organizeImports": "explicit" // [!code ++]
  } // [!code ++]
} // [!code ++]
```

::: details å…·ä½“è¯´æ˜

## ğŸ§© ç°è±¡èƒŒåçš„é€»è¾‘é“¾

æ–°å¢çš„è¿™æ®µé…ç½®ï¼š

```json
// --- æ–°å¢é…ç½®ï¼šåªé’ˆå¯¹ Vue/JS ä½¿ç”¨ Prettier ---
"[vue]": {
  "editor.defaultFormatter": "dbaeumer.vscode-eslint"
},
"[javascript]": {
  "editor.defaultFormatter": "dbaeumer.vscode-eslint"
},
"editor.codeActionsOnSave": {
  "source.fixAll.eslint": "explicit",
  "source.organizeImports": "explicit"
}
```

è®© VS Code æ˜ç¡®åœ°æ‰§è¡Œäº† **â€œç”± ESLint è´Ÿè´£æ ¼å¼åŒ–â€** è¿™ä¸€è¡Œä¸ºã€‚
 äºæ˜¯ï¼Œâ€œé—ªè·³â€å°±æ¶ˆå¤±äº†ã€‚ä¸ºä»€ä¹ˆï¼ŸğŸ‘‡

------

## âš™ï¸ åŸç†åˆ†æï¼ˆå…³é”®ç‚¹åœ¨ VS Code çš„è¡Œä¸ºä¼˜å…ˆçº§ï¼‰

å½“ä½ ä¿å­˜æ–‡ä»¶æ—¶ï¼ŒVS Code å¯èƒ½è§¦å‘å¤šä¸ªã€Œæ ¼å¼åŒ–æ¥æºã€ï¼š

| ä¼˜å…ˆçº§ | æ¥æº                                            | è§¦å‘æ¡ä»¶                         |
| ------ | ----------------------------------------------- | -------------------------------- |
| 1ï¸âƒ£      | ä½ æ˜¾å¼æŒ‡å®šçš„ `editor.defaultFormatter`          | ä¼˜å…ˆæœ€é«˜ï¼ˆå½“å‰ç”Ÿæ•ˆï¼‰             |
| 2ï¸âƒ£      | è¯­è¨€æœåŠ¡å™¨ï¼ˆå¦‚ Volar/Veturï¼‰å†…ç½®çš„æ ¼å¼åŒ–        | å½“æœªæŒ‡å®š defaultFormatter æ—¶è§¦å‘ |
| 3ï¸âƒ£      | ESLint æ‰§è¡Œçš„è‡ªåŠ¨ä¿®å¤ï¼ˆ`source.fixAll.eslint`ï¼‰ | å½“ä¿å­˜æ—¶å¯ç”¨ Code Actions        |
| 4ï¸âƒ£      | å…¶ä»–æ‰©å±•æˆ–å†…ç½® formatterï¼ˆå¦‚ Prettier æ’ä»¶ï¼‰    | å½“ VS Code æœªæ˜ç¡®æŒ‡æ´¾æ—¶è§¦å‘      |

------

## ğŸ§  åŸå§‹çŠ¶æ€ï¼ˆæœ‰â€œé—ªè·³â€ï¼‰æ˜¯è¿™æ ·ï¼š

1. ä½ ç¦ç”¨äº† Prettier æ‰©å±• âœ…
2. ä½† VS Code æœªæ˜ç¡®æŒ‡å®šè°æ˜¯ formatter âŒ
3. Volarï¼ˆæˆ– JS è¯­è¨€æœåŠ¡ï¼‰å‘ç°æ²¡æœ‰é»˜è®¤ formatterï¼Œäºæ˜¯è°ƒç”¨äº† Prettier å†…éƒ¨é€»è¾‘æ ¼å¼åŒ–
4. ç´§æ¥ç€ ESLintï¼ˆé€šè¿‡ fixAllï¼‰å†ä¿®å¤ â†’ â€œé—ªè·³â€ç°è±¡å‡ºç°

> ğŸŒ€ **ç»“æœï¼šä¸¤ä¸ªä¸åŒçš„ formatter æ¥è¿ä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ã€‚**

------

## âœ¨ ä½ çš„æ–°é…ç½®ä¿®å¤äº†å†²çªçš„åŸå› 

å½“ä½ åŠ ä¸Šï¼š

```
"[vue]": { "editor.defaultFormatter": "dbaeumer.vscode-eslint" }
```

VS Code æ˜ç¡®å‘Šè¯‰è‡ªå·±ï¼š

> ã€Œä¿å­˜ .vue æ–‡ä»¶æ—¶ï¼Œåªè°ƒç”¨ ESLint ä¿®å¤ï¼Œä¸ä½¿ç”¨å…¶ä»– formatterã€‚ã€

äºæ˜¯æµç¨‹å˜æˆï¼š

```
ä¿å­˜æ–‡ä»¶ â†’
ä»…æ‰§è¡Œ ESLint çš„ fixAll â†’
eslint-plugin-prettier åœ¨ ESLint å†…éƒ¨è°ƒç”¨ prettier æ ¼å¼åŒ– â†’
ç»“æœä¸€æ¬¡å®Œæˆï¼Œæ— äºŒæ¬¡è¦†ç›–
```

------

## âœ… ç»“è®ºæ€»ç»“

| é¡¹ç›®çŠ¶æ€                             | æ ¼å¼åŒ–æ¥æº              | æ˜¯å¦å†²çª   | è¯´æ˜         |
| ------------------------------------ | ----------------------- | ---------- | ------------ |
| æœªæŒ‡å®š formatter                     | Volar + ESLint          | âš ï¸ é—ªè·³     | ä¸¤è€…éƒ½æ ¼å¼åŒ– |
| æŒ‡å®š `dbaeumer.vscode-eslint`        | ESLintï¼ˆè°ƒç”¨ Prettierï¼‰ | âœ… æ— å†²çª   | ç»Ÿä¸€æ§åˆ¶     |
| å¯ç”¨ Prettier æ‰©å±•ä½†ä¸ç¦ ESLint      | ESLint + Prettier æ‰©å±•  | âš ï¸ é—ªè·³     | ä¸¤å¥—ç³»ç»Ÿç«äº‰ |
| å®Œå…¨ç¦ç”¨ Prettier æ‰©å±• + æŒ‡å®š ESLint | ESLintï¼ˆå†…ç½® Prettierï¼‰ | ğŸŸ¢ ç†æƒ³çŠ¶æ€ | æ¨èå›¢é˜Ÿä½¿ç”¨ |

------

ğŸ’¡ **æ€»ç»“ä¸€å¥è¯ï¼š**

> ä½ è¿™æ®µé…ç½®çš„æœ¬è´¨ä½œç”¨ï¼Œæ˜¯è®© VS Code çš„ã€Œæ ¼å¼åŒ–è¡Œä¸ºã€**å®Œå…¨ç”± ESLint æ¥ç®¡**ï¼Œ
>  è€Œ ESLint å†é€šè¿‡ `eslint-plugin-prettier` å†…éƒ¨è°ƒç”¨ Prettier å®ç°ä¸€è‡´çš„æ ¼å¼åŒ–ã€‚
>  ä»æ­¤ VS Codeã€Prettierã€ESLint ä¸å†æ‰“æ¶ï¼Œä¸€åˆ‡å½’äºç»Ÿä¸€ã€‚ğŸ‘

:::



# uni-icon è¡Œå†…æ ·å¼çš„è¦†å†™

ç»„ä»¶æ ·å¼ä¼šå½±å“ä¸ä¹‹ç›¸é‚»çš„æ ‡ç­¾æˆ–æ–‡å­—ï¼Œä½¿ä¸¤è€…ä¸åœ¨åŒä¸€æ°´å¹³çº¿ä¸Šå› æ­¤éœ€è¦è¡Œå†…è¦†å†™ï¼š

```html
<view class="right-info">
  <uni-icons
    type="location"
    size="24"
    style="margin-left: -10rpx"
  ></uni-icons>
  <view>
    {{ greenhouse.name }}
  </view>
</view>
```

