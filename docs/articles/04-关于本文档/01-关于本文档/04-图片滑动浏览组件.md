# å‡ºç°éœ€æ±‚

éœ€è¦åœ¨æ–‡æ¡£å±•ç¤ºå¤šå¼ ç…§ç‰‡æ—¶ï¼Œåœ¨ç§»åŠ¨ç«¯ä¼šç«–ç›´ä¾æ­¤æ’åˆ—ï¼Œå½±å“é˜…è¯»ä½“éªŒã€‚

## å‡†å¤‡å·¥ä½œ

é¦–å…ˆï¼Œç¡®è®¤ vitepress é¡¹ç›®çš„ç»„ä»¶å¯¼å…¥æ–¹å¼ï¼š

åœ¨ `.vitepress/theme/index.js` ä¸­æ³¨å†Œç»„ä»¶ & å¯¼å…¥å…¨å±€æ ·å¼

```js
// .vitepress/theme/index.js
import DefaultTheme from 'vitepress/theme'
// è‡ªå®šä¹‰ç»„ä»¶å¯¼å…¥
import ImgScroller from './components/ImgScroller.vue'
import './custom.css' // å¯é€‰ï¼šç”¨äºè¦†ç›– theme å±‚çº§çš„å…¨å±€æ ·å¼

export default {
  extends: DefaultTheme,
  enhanceApp ({ app }) {
    // å…¨å±€æ³¨å†Œç»„ä»¶ï¼ˆåœ¨ markdown ä¸­ç›´æ¥ä½¿ç”¨ <ImgScroller>ï¼‰
    app.component('ImgScroller', ImgScroller)
  }
}
```

è¯´æ˜ï¼šä½¿ç”¨ `extends: DefaultTheme` + `enhanceApp` å¯ä»¥åœ¨ä¸é‡å†™æ•´ä¸ªä¸»é¢˜çš„æƒ…å†µä¸‹æ³¨å…¥å…¨å±€ç»„ä»¶å’Œæ ·å¼ã€‚[VitePress+1](https://vitepress.dev/guide/custom-theme?utm_source=chatgpt.com)

ä½ ä¹Ÿå¯ä»¥æŠŠ CSS ç›´æ¥æ”¾åˆ° `ImgScroller.vue` ä¸­ã€‚

## å°è£…

åˆ›å»ºç»„ä»¶ï¼š

```vue
<template>
  <div class="img-scroll-wrapper" ref="wrapper">
    <!-- æç¤ºæ¡† -->
    <div :class="['swipe-hint', { show: showHint }]">
      <!-- slot æç¤º -->
      <slot name="hint" :type="hintType">
        <!-- é»˜è®¤æç¤ºæ–‡å­—ï¼ˆå¦‚æœå¤–éƒ¨æ²¡å®šä¹‰ slotï¼‰ -->
        <span v-if="hintType === 'start'">ğŸ‘‰ å‘å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤šå›¾ç‰‡</span>
        <span v-else>è¿™æ˜¯æœ€åä¸€å¼ å›¾ç‰‡äº†</span>
      </slot>
    </div>

    <!-- æ»‘åŠ¨å®¹å™¨ -->
    <div class="img-scroll-inner" ref="scroller" @scroll="onScroll">
      <slot />
    </div>
  </div>
</template>

<script>
import { ref, onMounted, onBeforeUnmount } from 'vue'

export default {
  name: 'ImgScroller',
  props: {
    autoHideMs: { type: Number, default: 2500 }, // æç¤ºè‡ªåŠ¨éšè—æ—¶é—´ï¼ˆmsï¼‰
    mobileMaxWidth: { type: Number, default: 768 } // è®¤ä¸ºæ˜¯ç§»åŠ¨ç«¯çš„å®½åº¦é˜ˆå€¼
  },
  setup(props) {
    const scroller = ref(null)
    const wrapper = ref(null)
    const showHint = ref(false)
    const hintType = ref('start') // 'start' | 'end'

    let hideTimer = null
    let showDelayTimer = null
    let atEndHintShown = false

    const isMobile = () => window.innerWidth <= props.mobileMaxWidth

    // æ˜¾ç¤ºæç¤ºæ¡†å¹¶è‡ªåŠ¨éšè—
    const startHintTimer = (type) => {
      if (!isMobile()) return
      clearTimeout(showDelayTimer)
      clearTimeout(hideTimer)

      hintType.value = type

      // å…ˆå»¶è¿Ÿ1.5ç§’æ˜¾ç¤ºæç¤º
      showDelayTimer = setTimeout(() => {
        showHint.value = true
        // æ˜¾ç¤ºåå†ç­‰ autoHideMs æ¯«ç§’éšè—
        hideTimer = setTimeout(() => {
          showHint.value = false
        }, props.autoHideMs)
      }, 1500)
    }
    
    const isScrollAtEnd = () => {
      if (!scroller.value) return false
      const el = scroller.value
      return el.scrollWidth - el.scrollLeft - el.clientWidth < 10
    }

    // onScroll æ˜¯ç»‘å®šåœ¨æ»‘åŠ¨å®¹å™¨ .img-scroll-inner çš„ @scroll äº‹ä»¶ä¸Šçš„
    // å½“ç”¨æˆ·æ¨ªå‘æ»šåŠ¨æ—¶ï¼Œå®ƒä¼šè¢«è§¦å‘
    const onScroll = () => {
      if (isScrollAtEnd()) {
        if (!atEndHintShown) {
          startHintTimer('end')
          atEndHintShown = true
        }
      } else {
        atEndHintShown = false
      }
    }

    onMounted(() => {
      if (isMobile()) {
        const observer = new IntersectionObserver(
          (entries) => {
            if (entries[0].isIntersecting) {
              startHintTimer('start')
              observer.disconnect()
            }
          },
          { threshold: 0.1 }
        )
        if (wrapper.value) {
          observer.observe(wrapper.value)
        }
      }
    })

    onBeforeUnmount(() => {
      clearTimeout(hideTimer)
      clearTimeout(showDelayTimer)
    })

    return { scroller, wrapper, showHint, onScroll, hintType }
  }
}
</script>

<style scoped>
/* æ»‘åŠ¨å®¹å™¨æ ·å¼ */
.img-scroll-inner {
  height: 350px;
  display: flex;
  gap: 10px;
  overflow-x: auto;   /* æ¨ªå‘æ»šåŠ¨ */
  overflow-y: hidden; /* éšè—å‚ç›´æ»šåŠ¨æ¡ */
  scroll-snap-type: x mandatory; /* å¯é€‰ï¼šè®©æ»‘åŠ¨å¯¹é½ */
  -webkit-overflow-scrolling: touch; /* iOS æƒ¯æ€§æ»‘åŠ¨ */
  padding-bottom: 10px; /* é˜²æ­¢æ»šåŠ¨æ¡é®ä½å†…å®¹ */
}

/* å›¾ç‰‡æ ·å¼ */
/* ç©¿é€ slot å†… img å…ƒç´  */
::v-deep(.img-scroll-inner img) {
  flex: 0 0 auto;
  scroll-snap-align: start;
  border-radius: 4px;
}

/* éšè—æ»šåŠ¨æ¡ï¼ˆå¯é€‰ï¼‰ */
/* .img-scroll::-webkit-scrollbar {
  display: none;
} */

.img-scroll-wrapper {
  position: relative; /* æ–°å¢ï¼Œå»ºç«‹å®šä½ä¸Šä¸‹æ–‡ */
}


/* ä¼˜åŒ–çš„ Toast æ ·å¼æç¤º */
.swipe-hint {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  max-width: 80vw;
  padding: 10px 20px;
  background: rgba(58, 58, 58, 0.9);
  color: white;
  font-size: 16px;
  border-radius: 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  pointer-events: none;
  opacity: 0;
  transition: opacity 1.2s ease;
  z-index: 1000;
  user-select: none;
  white-space: nowrap;
}

.swipe-hint.show {
  opacity: 1;
}
</style>
```

å…¶ä¸­ï¼š

```html
<!-- é»˜è®¤æç¤ºæ–‡å­—ï¼ˆå¦‚æœå¤–éƒ¨æ²¡å®šä¹‰ slotï¼‰ -->
<span v-if="hintType === 'start'">ğŸ‘‰ å‘å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤šå›¾ç‰‡</span>
<span v-else>è¿™æ˜¯æœ€åä¸€å¼ å›¾ç‰‡äº†</span>
</slot>
```

å®ƒçš„ä½œç”¨æ˜¯ï¼š

- **ä½œä¸ºæ’æ§½çš„é»˜è®¤å†…å®¹**ï¼Œå½“çˆ¶ç»„ä»¶æ²¡æœ‰ä¼ å…¥åä¸º `hint` çš„å…·åæ’æ§½æ—¶ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°±ä¼šæ˜¾ç¤ºã€‚
- ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç›¸å½“äºç»™æ’æ§½æä¾›äº†ä¸€ä¸ªâ€œé»˜è®¤æ¨¡æ¿â€ï¼Œç¡®ä¿ç»„ä»¶å³ä½¿å¤–éƒ¨æ²¡æœ‰ä¼ è‡ªå®šä¹‰å†…å®¹ï¼Œä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºæç¤ºæ–‡å­—ã€‚

::: details è¯¦è§£åˆ¤æ–­æ˜¯å¦æ»šåŠ¨åˆ°æœ«å°¾çš„é€»è¾‘

```
const isScrollAtEnd = () => {
  if (!scroller.value) return false
  const el = scroller.value
  return el.scrollWidth - el.scrollLeft - el.clientWidth < 10
}
```

------

æ‹†è§£ä¸€ä¸‹è¿™æ®µé€»è¾‘ï¼š

1. **`el.scrollWidth`**

   - å†…å®¹çš„æ€»å®½åº¦ï¼ˆåŒ…æ‹¬ä¸å¯è§çš„éƒ¨åˆ†ï¼‰ã€‚

2. **`el.scrollLeft`**

   - å½“å‰å·²ç»æ°´å¹³æ»šåŠ¨çš„è·ç¦»ã€‚

3. **`el.clientWidth`**

   - å®¹å™¨æœ¬èº«çš„å¯è§†å®½åº¦ã€‚

4. **æœ«å°¾åˆ¤æ–­å…¬å¼**

   ```
   el.scrollWidth - el.scrollLeft - el.clientWidth
   ```

   - è¿™ä¸ªå€¼è¡¨ç¤º**å‰©ä½™å¯æ»šåŠ¨çš„è·ç¦»**ã€‚
   - å¦‚æœè¿™ä¸ªå€¼ **å°äº 10 åƒç´ **ï¼ˆ`< 10`ï¼‰ï¼Œå°±è®¤ä¸ºâ€œå·²ç»åˆ°æœ«å°¾â€äº†ã€‚

------

ä¸ºä»€ä¹ˆç”¨ `< 10` è€Œä¸æ˜¯ `=== 0`ï¼Ÿ

- åœ¨å®é™…æ»šåŠ¨ä¸­å¯èƒ½ä¼šå‡ºç°**å°æ•°**æˆ–**æµ®ç‚¹è®¡ç®—è¯¯å·®**ï¼ˆæ¯”å¦‚ `0.0003` æˆ– `-0.5`ï¼‰ã€‚
- ä¸åŒæµè§ˆå™¨å’Œè§¦æ§è®¾å¤‡çš„æ»šåŠ¨æƒ¯æ€§ä¹Ÿå¯èƒ½å¯¼è‡´ç•¥å¾®è¶…å‡ºæˆ–ä¸è¶³æœ«å°¾ã€‚
- åŠ ä¸€ä¸ªå®¹å·®ï¼ˆ`< 10`ï¼‰å¯ä»¥è®©ä½“éªŒæ›´ç¨³å®šï¼Œé¿å…è¯¯åˆ¤ã€‚

------

âœ… **ç»“è®º**
 `isScrollAtEnd()` èƒ½å¤Ÿåˆ¤æ–­**æ˜¯å¦å·²ç»æ»šåŠ¨åˆ°æœ«å°¾**ï¼ˆåŒ…æ‹¬æ¥è¿‘æœ«å°¾çš„å®¹å·®èŒƒå›´ï¼‰ã€‚
 æ‰€ä»¥å®ƒä¸ä»…èƒ½åº”å¯¹ç²¾ç¡®æ»šåŠ¨ï¼Œè¿˜èƒ½å®¹å¿å¾®å°çš„æ»šåŠ¨è¯¯å·®ï¼Œè¿™å°±æ˜¯å®ƒæ¯”è¾ƒå®ç”¨çš„åŸå› ã€‚

:::



## ä½¿ç”¨

é¡µé¢ä¸­çš„ä½¿ç”¨ï¼š

```html
<ImgScroller>
	<template #hint="{ type }">
    <span v-if="type === 'start'">ğŸ“Œ è‡ªå®šä¹‰æç¤ºï¼šå‘å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š</span>
    <span v-else>ğŸ“Œ è‡ªå®šä¹‰æç¤ºï¼šè¿™æ˜¯æœ€åä¸€å¼ äº†</span>
  </template>
  <!-- å¦‚æœå›¾ç‰‡å› ä¸ºè·¯å¾„é”™è¯¯ã€ç½‘ç»œæ…¢æˆ–è¢«é˜»æ­¢è€Œæ— æ³•æ˜¾ç¤ºï¼Œæµè§ˆå™¨ä¼šç”¨ alt å†…å®¹æ›¿ä»£æ˜¾ç¤ºã€‚ -->
	<img src="/xiangfa-äº¬ä¸œå†œèµ„æ‹›å‹Ÿ.png" alt="A" />
  <img src="/xiangfa-äº¬ä¸œå†œèµ„é—¨åº—.png" alt="B" />
  <img src="/xiangfa-äº¬ä¸œå†œèµ„æ‹›å‹Ÿ1.png" alt="C" />
</ImgScroller>

```

 

  